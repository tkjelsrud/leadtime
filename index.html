<html>
<head>
  <style>
    body {
      font-family: Verdana;
      font-size: 10px;
    }
  	#error {
      color: red; 
      background-color: #DDD;
    }
  </style>
  <script type="text/javascript" src="https://pgrabovets.github.io/json-view/jsonview.bundle.js"></script>
</head>

<body onpaste="parsePased(event)">
  <div id="error" style="display:none">&nbsp;</div>
  <table>
    <tr><th>ID</th><th>x</th><th>x</th><th>x</th></tr>
  </table>


<script type="text/javascript">
var memory = {'items': {}};

function showError(err) {
  document.getElementById("error").style.display = "block";
  document.getElementById("error").innerText = err;
  
  setTimeout(function() {document.getElementById("error").style.display = "none";}, 3000);
}
  
function parsePased(ev) {
  //console.log(ev);
  data = ev.clipboardData.getData("text/plain");
  jsn  = jsonParse(data);
  if(jsn) {
    if(validJiraItem(jsn)) {
      showError("JSON received ok!");
      memory.items[jsn.key] = jsn;
      storeJiraItem(jsn.key, jsn);
    }
    else {
      showError("JSON received was not parsed as a valid jira item");
    }
  }
  else {
    showError("Value pasted was not parsed as valid JSON");
  }
  
  return false;
}
  
function jsonParse(data) {
  try {
    jsn = JSON.parse(data);
  } catch (e) {
    return null;
  }
  return jsn;
}
  
function validJiraItem(jsn) {
  if(!("fields" in jsn)) return false;
  if(!("changelog" in jsn)) return false;
  
  return true;
}
  
function storeJiraItem(jkey, jsn) {
  localStorage.setItem(jkey, jsn);
}
</script>
<script type="text/javascript">

</script>
</body>
</html>
